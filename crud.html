<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>CRUD Montres</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Styles: tout-en-un pour Ãªtre autonome -->
  <link rel="stylesheet" href="styles/crud.css">
  
  <script src="js/marque.js" defer></script>
  <script src="js/crud.js" defer></script>
 <!-- dans <head> -->



  <!-- Librairies ZIP (optionnelles si tu utilises downloadZip) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip-utils/0.1.0/jszip-utils.min.js"></script>
  
  
</head>

<body>

  <h1>Gestion des produits</h1>

  <div>
    <!-- <button onclick="window.open('https://docs.google.com/spreadsheets/d/1RImwBSEucX0d6chHduucER-GVvM_nzlSFmvAjlQnScg/edit?usp=sharing', '_blank')">GoogleSheet</button> -->
    <!-- <button onclick="downloadZip()">TÃ©lÃ©charger ZIP</button> -->
    <button onclick="window.location.href='index.html'">ğŸ  Voir les produits</button>
    <button onclick="openBrandModal()">ğŸ·ï¸ Marques</button>
    <button onclick="openAddModal()">â• Ajouter un produit</button>
    <!-- <button onclick="downloadProduitsCSV()">ğŸ“„ CrÃ©er produits.csv</button> -->
    <button onclick="sendSQLiteDataToServer()">ğŸ“¤ Envoyer donnÃ©es vers serveur</button>
    <!-- <button onclick="window.location.href='creerZip.php'">ğŸ“„ CrÃ©er Zip pour tablette</button> -->
  </div>

  <div id="filters" style="margin-bottom: 12px;">
    <button onclick="filterCategory('All')">ğŸ“¦ Tous</button>
    <button onclick="filterCategory('Montres')">âŒš Montres</button>
    <button onclick="filterCategory('Chaussures')">ğŸ‘Ÿ Chaussures</button>
    <button onclick="filterCategory('Autres')">ğŸ“ Autres</button>
  </div>

  <table>
    <!-- Largeurs fixes (total = 100%) pour Ã©viter tout espace vide -->
    <colgroup>
  <col style="width:6%"><!-- Reference -->
  <col style="width:8%"><!-- Marque -->
  <col style="width:10%"><!-- Nom -->
  <col style="width:7%"><!-- Prix -->
  <col style="width:7%"><!-- Promotion -->
  <col style="width:12%"><!-- Courte description -->
  <col style="width:16%"><!-- Description -->
  <col style="width:18%"><!-- Images -->
  <col style="width:6%"><!-- Actions -->
  <col style="width:5%"><!-- CatÃ©gorie -->
  <col style="width:3%"><!-- Ã‰tat -->
  <col style="width:2%"><!-- Status -->
</colgroup>

<thead>
  <tr>
    <th>Reference</th>
    <th>Marque</th>
    <th>Nom</th>
    <th>Prix</th>
    <th>Promotion</th>
    <th>Courte description</th>
    <th class="col-description">Description</th>
    <th>Images</th>
    <th>Actions</th>
    <th>CatÃ©gorie</th>
    <th>Ã‰tat</th>
    <th>Status</th>
  </tr>
</thead>

    <tbody id="montreTable"></tbody>
  </table>

  <!-- Modale Slider -->
  <div id="modal">
    <button class="close" onclick="closeModal()">âœ–</button>
    <img id="modal-image" alt="">
    <div>
      <button onclick="prevImage()">â¬…ï¸</button>
      <button onclick="nextImage()">â¡ï¸</button>
    </div>
  </div>

<!-- Modale d'Ã©dition d'image (dans le form edit) -->
<div id="editImageModal" class="img-edit-modal" style="display:none;">
  <div class="img-edit-modal-content">
    <button class="close" onclick="closeEditImageModal()">âœ–</button>
    <img id="editImageModalImg" alt="">
    <div class="actions">
      <button type="button" onclick="triggerReplace()">ğŸ“ Remplacer</button>
      <button type="button" onclick="deleteCurrentSlot()">ğŸ—‘ï¸ Supprimer</button>
    </div>
  </div>
</div>

<!-- Input cachÃ© pour choisir un fichier de remplacement -->
<input type="file" id="replaceImageInput" accept="image/*" style="display:none">



  <!-- Modale Formulaire -->
<!-- Modale Formulaire -->
<div id="formModal">
  <form id="formMontre" enctype="multipart/form-data">
    <input type="hidden" name="id">

    <label>Reference :
      <input type="text" name="reference" required>
    </label>

    <!-- ğŸ·ï¸ Marque (select rempli par fetchBrands) -->
    <label>Marque :
      <div class="d-flex gap-2">
        <select name="marque" id="brandSelect" class="form-select" required>
          <option value="" selected disabled>â€” Choisir une marque â€”</option>
          <!-- options injectÃ©es par JS -->
        </select>
        <button type="button" class="btn btn-outline" onclick="openBrandModal()">+ Ajouter</button>
      </div>
      <small class="text-secondary">SÃ©lectionne une marque existante ou crÃ©e-en une.</small>
    </label>

    <label>Nom :
      <input type="text" name="nom" required>
    </label>

    <label>Prix :
      <input type="number" name="prix" required>
    </label>

    <label>Promotion :
      <input type="number" name="promotion" placeholder="entrer le nouveau prix">
    </label>

    <label>Courte description :
      <textarea name="short_description" rows="2" maxlength="160" placeholder="RÃ©sumÃ© court (max 160)"></textarea>
    </label>

    <label>Description :
      <textarea name="description" rows="3" required></textarea>
    </label>

    <label>Images :
      <input type="file" name="images" accept="image/*" multiple>
    </label>
    <div id="imagesPreview" class="thumbs"></div>

    <label>CatÃ©gorie :
      <select name="categorie" class="form-select">
        <option>Montres</option>
        <option>Chaussures</option>
        <option>Autres</option>
      </select>
    </label>

    <label>Etat :
      <input type="text" name="etat" value="Neuf" required>
    </label>

    <label>Status :
      <select name="status" class="form-select">
        <option value="disponible">Disponible</option>
        <option value="achat en cours">Achat en cours</option>
        <option value="vendu">Vendu</option>
      </select>
    </label>

    <div class="d-flex gap-2 mt-2">
      <button type="submit" class="btn btn-primary">ğŸ’¾ Enregistrer</button>
      <button type="button" class="btn btn-outline" onclick="closeModalForm()">âŒ Annuler</button>
    </div>
  </form>
</div>

  <div id="spinner"><div></div></div>

  <!-- Modale Marques -->
<div id="brandModal" class="img-edit-modal" style="display:none;">
  <div class="img-edit-modal-content">
    <button class="close" onclick="closeBrandModal()">âœ–</button>
    <h3 style="margin:0">Nouvelle marque</h3>

    <form id="formBrand">
      <div class="mb-2">
        <label>Nom de la marque</label>
        <input type="text" name="brand_name" class="form-control" placeholder="Ex: Omega" required>
      </div>

      <div class="mb-2">
        <label>Logo (PNG/JPG/WebP)</label>
        <input type="file" id="brandLogoInput" class="form-control" accept="image/*">
        <div id="brandLogoPreview" class="mt-2"></div>
      </div>

      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">Enregistrer</button>
        <button type="button" class="btn btn-outline" onclick="closeBrandModal()">Annuler</button>
      </div>
    </form>
  </div>
</div>

  
</body>
</html>
